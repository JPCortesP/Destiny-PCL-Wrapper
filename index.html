<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Destiny-pcl-wrapper by JPCortesP</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Destiny-pcl-wrapper</h1>
        <p class="header">Yet another Destiny Client. this time for .NET</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/JPCortesP/Destiny-PCL-Wrapper/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/JPCortesP/Destiny-PCL-Wrapper/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/JPCortesP/Destiny-PCL-Wrapper">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/JPCortesP">JPCortesP</a></p>


      </header>
      <section>
        <h1>
<a id="destinypcl-client-c-library" class="anchor" href="#destinypcl-client-c-library" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DestinyPCL-Client C# Library</h1>

<p>Testing Project for a Destiny PCL API Wrapper in C#</p>

<p>Still in development, breaking changes are expected. </p>

<p><a href="https://ci.appveyor.com/project/JPCortesP/destiny-pcl-wrapper/branch/master"><img src="https://ci.appveyor.com/api/projects/status/xvshwxf7fmjg8n53/branch/master?svg=true" alt="Build status"></a></p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<div class="highlight highlight-source-cs"><pre>DestinyService ds = <span class="pl-k">new</span> DestinyService(<span class="pl-k">new</span> DestinyPCL.Manifest.OnlineManifest(), <span class="pl-s"><span class="pl-pds">"</span>YOUR API KEY<span class="pl-pds">"</span></span>);
<span class="pl-k">var</span> Player = <span class="pl-k">await</span> ds.getPlayerAsync(<span class="pl-k">new</span> DestinyPCL.Objects.BungieUser(<span class="pl-s"><span class="pl-pds">"</span>GamerTag / PSN ID<span class="pl-pds">"</span></span>, DestinyPCL.Objects.DestinyMembershipType.Xbox));
<span class="pl-k">foreach</span> (<span class="pl-k">var</span> character <span class="pl-k">in</span> Player.Characters)
{
    Console.WriteLine(<span class="pl-s"><span class="pl-pds">"</span>{0} - {1}<span class="pl-pds">"</span></span>, character.Class, character.LightLevel);
}</pre></div>

<h3>
<a id="destiny-manifest" class="anchor" href="#destiny-manifest" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Destiny Manifest</h3>

<p>Destiny API uses an obscure way to get item, activity, gear, stats, (long etc) definitions. This Repo contains:</p>

<ul>
<li>OnlineManifest, to query directly the API. SUPER SLOW. </li>
<li>OfflineManifest, deprecated, as uses raw JSON files obtained from <a href="https://github.com/nmlorg/destiny-db">https://github.com/nmlorg/destiny-db</a> expected to be directly embeded in the Library. It is currently
not being used, nor the json files are embeded, but it stays in the repo just for the lolz</li>
<li>Win32Manifest in a different project (currently trying to AppVeyor to build the nugget package) that runs only on Win32 (WPF, Console, ...) that directly downloads the manifest' SQLite database and queries.
Offcourse, it depends on System.Data.Sqlite nuget package. </li>
<li>An Interface, so you can build your own and just provide it to the Client. The client will fill the APIKey in case you need it. You're responsible to call Preload();</li>
</ul>

<p>More information is being writen as we speak, and should be available in the Wiki soon. </p>

<h3>
<a id="authenticated-request" class="anchor" href="#authenticated-request" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Authenticated Request.</h3>

<p>For any Auth Request, you must capture yourself the Cookies. For it, there's some help in DestinyPCL.AuthHelpers:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-c">//Get the PSN Login URL</span>
<span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">readonly</span> <span class="pl-k">string</span> PSNLoginUrl
<span class="pl-c">//Get the Xbox Login URL</span>
<span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">readonly</span> <span class="pl-k">string</span> XboxLoginUrl;
<span class="pl-c">//Array of all the Required Cookie Names to be in the Coockie Container</span>
<span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">readonly</span> <span class="pl-k">string</span>[] RequiredCookieNames;

<span class="pl-c">//Wanna Check if your CookieContainer has what it takes? use this function. </span>
<span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">bool</span> CheckForRequiredCookies(CookieContainer cookies);</pre></div>

<p>then use that Cookie Container inside a new (or existent) BungieUser object and call the APIs.</p>

<p>There's some examples in the Repo or in the Wiki. Check them out. </p>

<h3>
<a id="get-an-api-key" class="anchor" href="#get-an-api-key" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get an Api KEY</h3>

<p>from <a href="https://www.bungie.net/en/Clan/Post/39966/85087279/0/0">https://www.bungie.net/en/Clan/Post/39966/85087279/0/0</a> instructions, go to <a href="https://www.bungie.net/en/User/API">https://www.bungie.net/en/User/API</a>. </p>

<h2>
<a id="how-to-get-it" class="anchor" href="#how-to-get-it" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How to get it</h2>

<ul>
<li>Currently, is available in nuget as "DestinyPCL" and with the default Win32 implementation of the manifest as "DestinyPCL.Win32Manifest". 
This nugget package feed will be updated everytime a new commit is done on master. I'll try to avoid to push to master any non-working version.</li>
</ul>

<h2>
<a id="examples" class="anchor" href="#examples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Examples</h2>

<p>An usage example is below. This snippet runs and then shows in screen by character the best gear (by attack or deffense) 
that can be equipped on every character.</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> DestinyPCL.Objects<span class="pl-k">;</span>
<span class="pl-k">using</span> DestinyPCL.Win32Manifest<span class="pl-k">;</span>
<span class="pl-k">using</span> System<span class="pl-k">;</span>
<span class="pl-k">using</span> System.Linq<span class="pl-k">;</span>

<span class="pl-k">namespace</span> <span class="pl-en">ConsoleTests</span>
{
    <span class="pl-k">class</span> <span class="pl-en">Program</span>
    {

        [STAThread]
        <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">Main</span>(<span class="pl-k">string[]</span> <span class="pl-smi">args</span>)
        {
            <span class="pl-k">var</span> LoginWindow = <span class="pl-k">new</span> DestinyWeaponExplorer.LoginWindow();
            LoginWindow.ShowDialog();
            <span class="pl-k">var</span> user = <span class="pl-k">new</span> BungieUser() { GamerTag = <span class="pl-s"><span class="pl-pds">"</span>jpcortesp<span class="pl-pds">"</span></span>, type = DestinyMembershipType.Xbox };
            <span class="pl-k">if</span> (LoginWindow.Resultado)
            {
                user.cookies = LoginWindow.cookies;
            }
            <span class="pl-k">var</span> api = <span class="pl-k">new</span> DestinyPCL.DestinyService(<span class="pl-k">new</span> Win32Manifest(), <span class="pl-s"><span class="pl-pds">"</span>6def2424db3a4a8db1cef0a2c3a7807e<span class="pl-pds">"</span></span>);
            <span class="pl-k">var</span> player = api.getPlayerAsync(user).Result;
            player.BestGearbyBucket(player.Characters.First());
            <span class="pl-k">var</span> ItemTypes = player.Gear.Select(g =&gt; g.itemTypeName).Distinct();
            <span class="pl-c">//ALL THE GEAR ORDERED AND SHOWING THE BEST OF ANY TYPE.</span>
            <span class="pl-c">//=================================================================</span>
            <span class="pl-k">foreach</span> (<span class="pl-k">var</span> type <span class="pl-k">in</span> ItemTypes)
            {
                Console.WriteLine(<span class="pl-s"><span class="pl-pds">"</span>Top {0}s<span class="pl-pds">"</span></span>, type);
                Console.WriteLine(<span class="pl-s"><span class="pl-pds">"</span>=====================<span class="pl-pds">"</span></span>);
                <span class="pl-k">foreach</span> (<span class="pl-k">var</span> item <span class="pl-k">in</span> player.Gear.Where(g =&gt; g.itemTypeName == type).OrderByDescending(h =&gt; h.primaryStats_value).Take(<span class="pl-c1">2</span>))
                {
                    Console.WriteLine(<span class="pl-s"><span class="pl-pds">"</span>{0} - {1} - {2}<span class="pl-pds">"</span></span>, item.itemName, item.primaryStats_value, item.dbData?.classType);

                }
                Console.WriteLine(<span class="pl-s"><span class="pl-pds">"</span>{0} more {1}<span class="pl-pds">"</span></span>, player.Gear.Where(g =&gt; g.itemTypeName == type).Count() - <span class="pl-c1">2</span>, type);
                Console.WriteLine(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>);
            }
            Console.ReadLine();





        }
    }

}
</pre></div>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
